<h2>Resource Marketplace</h2>

<p-toast key="toastMsg" [baseZIndex]="100"></p-toast>

<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="item-tab" data-toggle="tab" href="#item" role="tab" aria-controls="item" aria-selected="true">Item</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="manpower-tab" data-toggle="tab" href="#manpower" role="tab" aria-controls="manpower" aria-selected="false">Manpower</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="venue-tab" data-toggle="tab" href="#venue" role="tab" aria-controls="venue" aria-selected="false">Venue</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="knowledge-tab" data-toggle="tab" href="#knowledge" role="tab" aria-controls="knowledge" aria-selected="false">Knowledge</a>
    </li>
</ul>
<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="item" role="tabpanel" aria-labelledby="item-tab">
        <div class="card">
            <p-dataView #dv [value]="items" [paginator]="true" [rows]="9" filterBy="title" [sortField]="sortField" [sortOrder]="sortOrder" layout="grid">
                <ng-template pTemplate="header">
                    <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between">
                        <p-dropdown [options]="sortOptions" [(ngModel)]="sortKeyItem" placeholder="Sort By Date" (onChange)="onSortChangeItem($event)" styleClass="p-mb-2 p-mb-md-0"></p-dropdown>
                        <p-dropdown [options]="countryOptions" [(ngModel)]="filterKeyCountryItem" placeholder="Filter By Country" (onChange)="filterCountryItems($event)"
                            styleClass="p-mb-2 p-mb-md-0"></p-dropdown>
                        <span class="p-input-icon-left p-mb-2 p-mb-md-0">
                            <i class="pi pi-search"></i>
                            <input type="search" pInputText placeholder="Search by Title" (input)="dv.filter($event.target.value)">
                        </span>
                    </div>
                </ng-template>
                <ng-template let-item pTemplate="gridItem">
                    <div class="p-col-12 p-md-3">
                        <div class="product-grid-item card p-3">
                            <div class="product-grid-item-top">
                                <div>
                                    <i class="pi pi-tag product-category-icon"></i>
                                    <span class="product-category itemtype rounded-sm text-white"> Item&nbsp;</span>
                                </div>
                            </div>
                            <div class="product-grid-item-content">
                                <img *ngIf="item.imgPath.length == 0" src="../../../assets/img/item.png" class="img-fluid" style="width: 100px; height: 100px; object-fit: cover;" [alt]="item.title"/>
                                <img *ngIf="item.imgPath.length != 0" src="https://localhost:8080{{item.imgPath}}" class="img-fluid" style="width: 100px; height: 100px; object-fit: cover;" [alt]="item.title"/>
                                <div class="product-name"><a href="/resource/resourceDetails?id={{item.id}}&type=item">{{item.title}}</a></div>
                                <div class="product-description">{{item.country}}</div>
                                <div class="product-description text-secondary">
                                    <small>Last updated: {{formatDate(item.updatedAt)}}</small>
                                </div>
                            </div>
                            <div class="product-grid-item-bottom">
                                <button (click)="setResourceId(item.id); setResourceType('item')" class="btn btn-primary btn-success" data-toggle="modal" data-target="#requestModal">Request</button>
                                <!-- <button *ngIf="!isOwner" pButton type="button" label="Request" 
                                    class="p-button-sm p-button-rounded p-button-success float-right"></button> -->
                            </div>
                        </div>
                    </div>
                </ng-template>
            </p-dataView>
        </div>
    </div>
    
    <div class="tab-pane fade" id="manpower" role="tabpanel" aria-labelledby="manpower-tab">
        <div class="card">
            <p-dataView #mp [value]="manpowers" [paginator]="true" [rows]="9" filterBy="title" [sortField]="sortFieldMpw" [sortOrder]="sortOrderMpw" layout="grid">
                <ng-template pTemplate="header">
                    <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between">
                        <p-dropdown [options]="sortOptions" [(ngModel)]="sortKeyMpw" placeholder="Sort By Date" (onChange)="onSortChangeManpower($event)" styleClass="p-mb-2 p-mb-md-0"></p-dropdown>
                        <p-dropdown [options]="countryOptions" [(ngModel)]="filterKeyCountryMpw" placeholder="Filter By Country" (onChange)="filterCountryMpws($event)"
                            styleClass="p-mb-2 p-mb-md-0"></p-dropdown>
                        <span class="p-input-icon-left p-mb-2 p-mb-md-0">
                            <i class="pi pi-search"></i>
                            <input type="search" pInputText placeholder="Search by Title" (input)="mp.filter($event.target.value)">
                        </span>
                    </div>
                </ng-template>
                <ng-template let-manpower pTemplate="gridItem">
                    <div class="p-col-12 p-md-4">
                        <div class="product-grid-item card p-3">
                            <div class="product-grid-item-top">
                                <div>
                                    <i class="pi pi-tag product-category-icon"></i>
                                    <span class="product-category manpowertype rounded-sm text-white"> Manpower&nbsp;</span>
                                </div>
                            </div>
                            <div class="product-grid-item-content">
                                <img *ngIf="manpower.ownerImg.length == 0" src="../../../assets/img/profilePic_Placeholder.png" class="img-fluid" style="width: 100px; height: 100px; object-fit: cover;" alt="Profile pic"/>
                                <img *ngIf="manpower.ownerImg.length != 0" src="https://localhost:8080{{manpower.ownerImg}}" class="img-fluid" style="width: 100px; height: 100px; object-fit: cover;" alt="Profile pic"/>
                                <div class="product-name"><a href="/resource/resourceDetails?id={{manpower.id}}&type=manpower">{{manpower.title}}</a></div>
                                <div class="product-description">{{manpower.country}}</div>
                                <div class="product-description text-secondary">
                                    <small>Last updated: {{formatDate(manpower.updatedAt)}}</small>
                                </div>
                            </div>
                            <div class="product-grid-item-bottom">
                                <button (click)="setResourceId(manpower.id); setResourceType('manpower')" class="btn btn-primary btn-success" data-toggle="modal" data-target="#requestModal">Request</button>
                                <!-- <button *ngIf="!isOwner" pButton type="button" label="Request" 
                                    class="p-button-sm p-button-rounded p-button-success float-right"></button> -->
                            </div>
                        </div>
                    </div>
                </ng-template>
            </p-dataView>
        </div>
    </div>

    <div class="tab-pane fade" id="venue" role="tabpanel" aria-labelledby="venue-tab">
        <div class="card">
            <p-dataView #ve [value]="venues" [paginator]="true" [rows]="9" filterBy="title" [sortField]="sortFieldVen" [sortOrder]="sortOrderVen" layout="grid">
                <ng-template pTemplate="header">
                    <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between">
                        <p-dropdown [options]="sortOptions" [(ngModel)]="sortKeyVen" placeholder="Sort By Date" (onChange)="onSortChangeVenue($event)" styleClass="p-mb-2 p-mb-md-0"></p-dropdown>
                        <p-dropdown [options]="countryOptions" [(ngModel)]="filterKeyCountryVen" placeholder="Filter By Country" (onChange)="filterCountryVens($event)"
                            styleClass="p-mb-2 p-mb-md-0"></p-dropdown>
                        <span class="p-input-icon-left p-mb-2 p-mb-md-0">
                            <i class="pi pi-search"></i>
                            <input type="search" pInputText placeholder="Search by Title" (input)="ve.filter($event.target.value)">
                        </span>
                    </div>
                </ng-template>
                <ng-template let-venue pTemplate="gridItem">
                    <div class="p-col-12 p-md-4">
                        <div class="product-grid-item card p-3">
                            <div class="product-grid-item-top">
                                <div>
                                    <i class="pi pi-tag product-category-icon"></i>
                                    <span class="product-category venuetype rounded-sm text-white"> Venue&nbsp;</span>
                                </div>
                            </div>
                            <div class="product-grid-item-content">
                                <img *ngIf="venue.imgPath.length == 0" src="../../../assets/img/venue.png" class="img-fluid" style="width: 100px; height: 100px; object-fit: cover;" [alt]="venue.title"/>
                                <img *ngIf="venue.imgPath.length != 0" src="https://localhost:8080{{venue.imgPath[0]}}" class="img-fluid" style="width: 100px; height: 100px; object-fit: cover;" [alt]="venue.title"/>
                                <div class="product-name"><a href="/resource/resourceDetails?id={{venue.id}}&type=venue">{{venue.title}}</a></div>
                                <div class="product-description">{{venue.country}}</div>
                                <div class="product-description text-secondary">
                                    <small>Last updated: {{formatDate(venue.updatedAt)}}</small>
                                </div>
                            </div>
                            <div class="product-grid-item-bottom">
                                <button (click)="setResourceId(venue.id); setResourceType('venue')" class="btn btn-primary btn-success" data-toggle="modal" data-target="#requestModal">Request</button>
                                <!-- <button *ngIf="!isOwner" pButton type="button" label="Request" 
                                    class="p-button-sm p-button-rounded p-button-success float-right"></button> -->
                            </div>
                        </div>
                    </div>
                </ng-template>
            </p-dataView>
        </div>
    </div>

    <div class="modal fade" id="requestModal" tabindex="-1" role="dialog" aria-labelledby="requestModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="requestModalLabel">Request Resource</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Select the project and specific resource need that you would like to request this resource for.<br/><br/>
                    <form name="form" (ngSubmit)="f.form.valid && onSubmit()" #f="ngForm" novalidate>
                        <!-- show current user's projects and get them to choose one -->
                        <div class="form-group row">
                            <label for="project" class="col-sm-3 col-form-label">Select Project</label>
                            <div class="col-sm-9">
                                <select class="form-control" name="project" [(ngModel)]="selectedProjectId" required #project="ngModel" (click)="updateSelectedProject($event)">
                                    <option *ngFor="let p of myProjects" value={{p.id}}>{{p.title}}</option>
                                </select>
                            </div>
                        </div>
                        <!-- if the selected project currently doesn't have a corresponding resource need -->
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="autogenerate" [checked]="autogenerateYes" (change)="updateAutogenerate($event);">
                            <label class="form-check-label" for="autogenerate">
                                I don't have a resource need for this yet, auto-generate it for me
                            </label>
                        </div><br/>
                        <!-- show resource needs of selected project and get user to choose one -->
                        <div class="form-group row" *ngIf= "!autogenerateYes">
                            <label for="resourceNeed" class="col-sm-3 col-form-label">Select Resource Need</label>
                            <div class="col-sm-9">
                                <select class="form-control" name="resourceNeed" [(ngModel)]="selectedResourceNeedId" required #resourceNeed="ngModel" (click)="updateSelectedResourceNeed($event)">
                                    <option *ngFor="let r of resourceNeeds" value={{r.id}} placeholder="Select resource need">{{r.title}}</option>
                                </select>
                            </div>
                        </div>
                        <!-- input description for resource request -->
                        <div class="form-group row">
                            <label for="desc" class="col-sm-3 col-form-label">Description</label>
                            <div class="col-sm-9">
                                <textarea class="form-control" name="desc" [(ngModel)]="form.desc" required #desc="ngModel" rows="3"></textarea>
                            </div>
                            <div class="alert-danger" *ngIf="f.submitted && desc.invalid">
                                <div *ngIf="desc.errors.required">Description is required</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary btn-block">Request</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="tab-pane fade" id="knowledge" role="tabpanel" aria-labelledby="knowledge-tab">
        <div class="card">
            <p-dataView #kn [value]="knowledges" [paginator]="true" [rows]="9" filterBy="title" [sortField]="sortFieldKno" [sortOrder]="sortOrderKno"  layout="grid">
                <ng-template pTemplate="header">
                    <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between">
                        <p-dropdown [options]="sortOptions" [(ngModel)]="sortKeyKno" placeholder="Sort By Date" (onChange)="onSortChangeKnowledge($event)" styleClass="p-mb-2 p-mb-md-0"></p-dropdown>
                        <span class="p-input-icon-left p-mb-2 p-mb-md-0">
                            <i class="pi pi-search"></i>
                            <input type="search" pInputText placeholder="Search by Title" (input)="kn.filter($event.target.value)">
                        </span>
                    </div>
                </ng-template>
                <ng-template let-knowledge pTemplate="gridItem">
                    <div class="p-col-12 p-md-4">
                        <div class="product-grid-item card p-3">
                            <div class="product-grid-item-top">
                                <div>
                                    <i class="pi pi-tag product-category-icon"></i>
                                    <span class="product-category knowledgetype rounded-sm text-white"> Knowledge&nbsp;</span>
                                </div>
                                <!-- <span class="float-right">{{formatDate(knowledge.updatedAt)}}</span> -->
                            </div>
                            <div class="product-grid-item-content">
                                <div class="product-name"><a href="/resource/resourceDetails?id={{knowledge.id}}&type=knowledge">{{knowledge.title}}</a></div>
                                <div class="product-description text-secondary">
                                    <small>Last updated: {{formatDate(knowledge.updatedAt)}}</small>
                                </div>
                            </div>
                            <div class="product-grid-item-bottom">
                                <!-- <button *ngIf="!isOwner" pButton type="button" label="Use in My Project" 
                                    class="p-button-sm p-button-rounded p-button-success float-right"></button> -->
                                <button (click)="setResourceId(knowledge.id); setResourceType('knowledge')" class="btn btn-primary btn-success" data-toggle="modal" data-target="#useKnowledgeModal">Use in My Project</button>
                            </div>
                        </div>
                    </div>
                </ng-template>
            </p-dataView>
            <div class="modal fade" id="useKnowledgeModal" tabindex="-1" role="dialog" aria-labelledby="useKnowledgeModal" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="useKnowledgeModalLabel">Use Knowledge Resource</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form name="form" (ngSubmit)="f.form.valid && onSubmitKnowledge()" #f="ngForm" novalidate>
                                This will notify the owner(s) of the knowledge resource that you have used their knowledge in your project.<br/><br/>
                                <!-- show current user's projects and get them to choose one -->
                                <div class="form-group row">
                                    <label for="project" class="col-sm-3 col-form-label">Select Project</label>
                                    <div class="col-sm-9">
                                        <select class="form-control" name="project" [(ngModel)]="selectedProjectId" required #project="ngModel" (click)="updateSelectedProject($event)">
                                            <option *ngFor="let p of myProjects" value={{p.id}}>{{p.title}}</option>
                                        </select>
                                    </div>
                                </div>
                                <!-- if the selected project currently doesn't have a corresponding resource need -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="autogenerate" [checked]="autogenerateYes" (change)="updateAutogenerate($event);">
                                    <label class="form-check-label" for="autogenerate">
                                        I don't have a resource need for this yet, auto-generate it for me
                                    </label>
                                </div><br/>
                                <!-- show resource needs of selected project and get user to choose one -->
                                <div class="form-group row" *ngIf= "!autogenerateYes">
                                    <label for="resourceNeed" class="col-sm-3 col-form-label">Select Resource Need:</label>
                                    <div class="col-sm-9">
                                        <select class="form-control" name="resourceNeed" [(ngModel)]="selectedResourceNeedId" required #resourceNeed="ngModel" (click)="updateSelectedResourceNeed($event)">
                                            <option *ngFor="let r of resourceNeeds" value={{r.id}}>{{r.title}}</option>
                                        </select>
                                    </div>
                                </div>
                                <!-- input description for resource request -->
                                <div class="form-group row">
                                    <label for="desc" class="col-sm-3 col-form-label">Description</label>
                                    <div class="col-sm-9">
                                        <textarea class="form-control" name="desc" [(ngModel)]="form.desc" required #desc="ngModel" rows="3"></textarea>
                                    </div>
                                    <div class="alert-danger" *ngIf="f.submitted && desc.invalid">
                                        <div *ngIf="desc.errors.required">Description is required</div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-primary btn-block">Submit</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
